{"version":3,"file":"semantic-api.js","sources":["../src/semantic-api.ts"],"sourcesContent":["interface customFunc {\r\n    (args: any[], calls: any[], url: string): void\r\n}\r\n\r\ninterface customMethods {\r\n    [propName:string]: customFunc\r\n}\r\n\r\ninterface queryOption {\r\n    [propName:string]: any\r\n}\r\n\r\ninterface semanticInstance{\r\n    [propName:string]: any\r\n}\r\n\r\nconst checkProxySupport = () => {\r\n    if (typeof Proxy === 'function') return\r\n    throw new Error('Proxy is not supported.')\r\n}\r\n\r\nconst isReflectorMethod = (methodName: string) => {\r\n    const reflectors = [\r\n        'valueOf',\r\n        'inspect',\r\n        'toString',\r\n        'constructor',\r\n        Symbol.toPrimitive,\r\n        Symbol.toStringTag,\r\n        Symbol.for('util.inspect.custom'),\r\n        Symbol.for('nodejs.util.inspect.custom')\r\n    ]\r\n    return reflectors.includes(methodName)\r\n}\r\n\r\nconst query = (args: any[], calls: any[], url: string) => {\r\n    const queryString = (opts: queryOption) => Object.keys(opts).map(key => `${key}=${encodeURIComponent(opts[key])}`).join('&')\r\n    const data = args.shift()\r\n    const prev = calls.pop() || ''\r\n    const result = data ? `${prev}?${queryString(data)}` : 'query'\r\n    calls.push(result)\r\n}\r\n\r\n/**\r\n * @param {string} baseUrl the baseUrl that will be added at the start of url\r\n * @param {object} customFunctions key-value custom method function\r\n */\r\nfunction SemanticApi (baseUrl: string = '', customFunctions: customMethods = {}): semanticInstance {\r\n    checkProxySupport()\r\n\r\n    let calls: string[] = []\r\n    const delimiter = '/'\r\n    const toString = () => baseUrl + calls.join(delimiter)\r\n\r\n    // Create proxy and declare set/apply trap\r\n    let proxy: null|Function = null\r\n    const methodList: customMethods = { query, ...customFunctions }\r\n    const isMethod = (name: string) => methodList.hasOwnProperty(name) && typeof methodList[name] === 'function'\r\n\r\n    const createProxy = () => {\r\n        const getTrap = (target: any, property: string, receiver: any) => {\r\n            if (isReflectorMethod(property)) return () => toString()\r\n            else calls.push(property)\r\n\r\n            return proxy\r\n        }\r\n\r\n        const applyTrap = (target: any, receiver: any, args: any[]) => {\r\n            const methodName = calls.pop()\r\n            if (isMethod(methodName)) {\r\n                const url = toString()\r\n                const result = methodList[methodName].call(this, args, calls, url)\r\n                if (result !== undefined) return result\r\n            } else {\r\n                calls.push(methodName, ...args)\r\n            }\r\n\r\n            return proxy\r\n        }\r\n\r\n        const noop = Object.seal(() => {})\r\n        return new Proxy(noop, { get: getTrap, apply: applyTrap })\r\n    }\r\n\r\n    proxy = createProxy()\r\n    return proxy\r\n}\r\n\r\nmodule.exports = SemanticApi\r\n"],"names":["checkProxySupport","Proxy","Error","isReflectorMethod","methodName","reflectors","Symbol","toPrimitive","toStringTag","for","includes","query","args","calls","url","queryString","opts","Object","keys","map","key","encodeURIComponent","join","data","shift","prev","pop","result","push","SemanticApi","baseUrl","customFunctions","delimiter","toString","proxy","methodList","isMethod","name","hasOwnProperty","createProxy","getTrap","target","property","receiver","applyTrap","call","undefined","noop","seal","get","apply","module","exports"],"mappings":"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"}